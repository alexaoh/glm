---
title: "Impacte del COVID-19 per estat de vacunació"
subtitle: "Linear and Generalized Linear Models"
author: "Alexander J Ohrt, Ulrik Danielsen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    theme: readable
    highlight: textmate
    number_sections: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE, warning = F)
setwd("/home/ajo/gitRepos/glm/Deliverable")
library(dplyr)
```

We are analyzing a data set that contains information about the impact of COVID-19 by vaccination status in 2021 in Catalunya. More information about the data set can be found [here](https://analisi.transparenciacatalunya.cat/en/Salut/Impacte-del-COVID-19-per-estat-de-vacunaci-/6izj-g3sb). 

The data set contains 6 columns. They are explained shortly below. 

| Variable    | SEXE                 | EDAT      | DATA | ESDEVENIMENT | PAUTA | RECOMPTE |
|-------------|----------------------|-----------|------|--------------|-------|----------|
| Explanation | Sex (Male or Female) | Age Group | Date |              | Vaccine?       |          |

# Objective

The objective of the analysis is to answer the following question: 
*Do differences in the severity of COVID-19 infection exist between people that are unvaccinated, people that only have received one dose and people that are fully vaccinated?*
More precisely, do the amount of people with a *critical* infection depend on their respective vaccination status?

The analysis will be performed separately for men and women. Moreover, we will only consider people that are older than 30 and only data from the 1st of May to the 12th of December of 2021.

# Data Preparation

First we have to remove all people younger than 30 years old and cases before the 1st of May. 

```{r}
data <- read.csv("Impacte_del_COVID-19_per_estat_de_vacunaci_.csv")
#dim(data)
#head(data)
#str(data)
#summary(data)
data$DATA <- as.Date(data$DATA, format = "%d/%m/%Y")
data$EDAT <- as.factor(data$EDAT)
covid.data <- data %>% filter(DATA >= "2021-05-01" & DATA <= "2021-12-12") %>% 
      filter(EDAT %in% c("30 a 39", "40 a 49", "50 a 59", "60 a 69", "70 a 79", "80 o més"))
# What about "No classificat"?
#ummary(covid.data)
#str(covid.data)
covid.data$EDAT <- factor(covid.data$EDAT, labels = c("30 a 39", "40 a 49", "50 a 59", "60 a 69", "70 a 79", "80 o més"))
covid.data$ESDEVENIMENT <- factor(covid.data$ESDEVENIMENT, labels = c("Cas", "Crit", "Def", "Hosp"))

# Need to make some more factors. 
```

**Make sure that the filtering etc is done correctly (later) IMPORTANT!**

```{r}
covid.data.women <- covid.data %>% filter(SEXE == "Dona")
covid.data.men <- covid.data %>% filter(SEXE == "Home")
```


# Exploratory Data Analysis 

The data set is split into men and women. There are `r dim(covid.data.men)[[1]]` men and `r dim(covid.data.women)[[1]]` in the data. Some barplots are shown below. 

```{r}
par(mfrow = c(1,2))
barplot(height = table(covid.data.men$EDAT), main = "Number of men in each age group")
barplot(height = table(covid.data.women$EDAT), main = "Number of women in each age group")
# Could surely do some fancy barplot with GGPlot showing the info for both at the same time!
```

Below one can see the four different types of cases for men and women separately. As noted, we are interested in the differences in critical COVID-19 infections. **I am guessin that Defunció and Hospitalització are worse than Critics, should we analyze these as well?**

```{r}
par(mfrow = c(1,2))
barplot(height = table(covid.data.men$ESDEVENIMENT), main = "Men of each case in each age group")
barplot(height = table(covid.data.women$ESDEVENIMENT), main = "Women of each case in each age group")
# Could surely do some fancy barplot with GGPlot showing the info for both at the same time!
```

The evolution of critical patients in time (in months) for men and women is shown below. 

```{r}
# Group
```

The data grouped as a function of vaccination status and age is shown in the following table. 

```{r}

```


# Model Fit  

# Conclusions